<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MY DICTIONARY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
      .sidebar-text {
        transition: opacity 0.2s ease-in-out;
      }
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Botão Hamburger personalizado */
      #checkbox {
        display: none;
      }

      .toggle {
        position: relative;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: center;
        gap: 10px;
        transition-duration: .5s;
      }

      .bars {
        width: 100%;
        height: 4px;
        background-color: rgb(92, 130, 255); /* Esta é a linha principal que dá a cor azul */
        border-radius: 4px;
        transition-duration: .5s;
      }

      #bar1 {
        width: 50%;
      }

      #bar2 {
        width: 75%;
      }
      .bars {
        width: 100%;
        height: 4px;
        background-color: rgb(92, 130, 255);
        border-radius: 4px;
      }

      #bar2 {
        transition-duration: .8s;
      }

      #bar1 {
        width: 50%;
      }

      #bar2 {
        width: 75%;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-300 min-h-screen flex flex-col">
    <div id="auth-container" class="fixed inset-0 bg-gray-900 z-50 flex items-center justify-center">
  <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm">
    <h2 class="text-2xl font-bold text-center text-custom-blue mb-6">Meu Dicionário</h2>
    <form id="login-form" class="space-y-4">
      <div>
        <label for="email" class="block text-gray-400">Email</label>
        <input type="email" id="email" class="w-full bg-gray-700 rounded px-3 py-2 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-custom-blue" required>
      </div>
      <div>
        <label for="password" class="block text-gray-400">Senha</label>
        <input type="password" id="password" class="w-full bg-gray-700 rounded px-3 py-2 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-custom-blue" required>
      </div>
      <button type="submit" class="w-full bg-custom-blue text-white font-bold py-2 rounded hover:bg-blue-600 transition-colors">Entrar / Registrar</button>
    </form>
    <p id="auth-error" class="text-red-500 text-center mt-4 hidden"></p>
  </div>
</div>
<div class="fixed top-3 right-4 z-40">
    <button id="logout-button" class="hidden bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md text-sm">Sair</button>
</div>
    <div id="app" class="flex-1 flex flex-col hidden">
      <!-- Header com botão hamburger customizado -->
      <header class="flex items-center justify-center bg-gray-800 px-4 py-3 shadow-md">
        <h1 class="text-xl font-bold select-none text-gray-300">Meu Dicionário</h1>
        <div class="w-6"></div>
      </header>


    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar / Menu -->
      <nav
        id="sidebar"
         class="fixed inset-y-0 left-0 z-30 bg-gray-800 shadow-lg transform -translate-x-full transition-all duration-300 ease-in-out md:shadow-none"
        aria-label="Menu principal"
      >
        <div class="px-6 py-6 border-b border-gray-700 flex items-center gap-4">

          <div id="btn-hamburger">
          <input id="checkbox" type="checkbox">
          <label class="toggle" for="checkbox">
            <div id="bar1" class="bars"></div>
            <div id="bar2" class="bars"></div>
            <div id="bar3" class="bars"></div>
          </label>
        </div>
            <h2 class="sidebar-title text-2xl italic font-extrabold text-custom-blue select-none tracking-wide drop-shadow-lg">
              Menu
            </h2>
            <button
              id="btn-close-sidebar"  
              aria-label="Fechar menu"
              class="text-gray-400 hover:text-custom-blue md:hidden focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-custom-blue rounded"
            >
            
              <i class="fas fa-times fa-lg"></i>
            </button>
          </div>
          <ul class="flex flex-col px-4 py-2 space-y-1 overflow-y-auto flex-1">
            <li>
             <button
                data-page="home"
                class="w-full flex items-center px-3 py-2 rounded-md hover:bg-[rgb(92,130,255)] hover:text-white focus:outline-none focus:bg-[rgb(92,130,255)] font-semibold"
              >
                <i class="fas fa-home w-8 text-center"></i>
                <span class="sidebar-text">Tela Inicial</span>
              </button>
            </li>
            <li>
              <button
                data-page="learned"
                class="w-full flex items-center px-3 py-2 rounded-md hover:bg-[rgb(92,130,255)] hover:text-white focus:outline-none focus:bg-[rgb(92,130,255)] font-semibold text-custom-blue"
              >
                <i class="fas fa-book-open w-8 text-center"></i>
                <span class="sidebar-text">Palavras Aprendidas</span>
              </button>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Overlay for mobile sidebar -->
      <div
        id="overlay"
        class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"
        tabindex="-1"
        aria-hidden="true"
      ></div>

      <!-- Main content -->
     <main
  id="main-content"
  class="flex-1 overflow-y-auto p-6 transition-all duration-300 ease-in-out"
  ...
>
        <!-- Home Page -->
        <section id="page-home" class="w-full max-w-3xl mx-auto pt-8">
          <div class="flex flex-col items-center space-y-6">
            <button
              id="btn-show-form"
              class="bg-gray-700 hover:bg-gray-600 text-[rgb(92,130,255)] font-semibold rounded-md px-8 py-3 focus:outline-none focus:ring-2 focus:ring-custom-blue transition-colors"
              aria-expanded="false"
              aria-controls="form-add-word"
            >
              Adicionar nova palavra
            </button>
          </div>

          <form
            id="form-add-word"
            class="space-y-6 bg-gray-800 p-6 rounded-lg shadow-lg mt-10 hidden"
            novalidate
            aria-hidden="true"
          >
            <h2 class="text-3xl font-bold text-custom-blue mb-4 select-none text-center">
              Adicionar uma nova palavra
            </h2>
            <div>
              <label for="input-word" class="block mb-1 font-semibold text-gray-400"
                >Palavra</label
              >
              <input
                type="text"
                id="input-word"
                name="word"
                placeholder="Digite a palavra"
                required
                class="w-full rounded-md bg-gray-700 border border-gray-600 text-gray-300 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-custom-blue focus:border-custom-blue px-3 py-2"
                autocomplete="off"
                aria-describedby="word-error"
              />
              <p id="word-error" class="text-red-500 text-sm mt-1 hidden">
                Por favor, insira uma palavra.
              </p>
            </div>

            <div>
              <label for="input-context" class="block mb-1 font-semibold text-gray-400"
                >Contexto / Exemplo</label
              >
              <textarea
                id="input-context"
                name="context"
                rows="3"
                placeholder="Exemplo ou contexto da palavra"
                class="w-full rounded-md bg-gray-700 border border-gray-600 text-gray-300 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-custom-blue focus:border-custom-blue px-3 py-2 resize-none"
                autocomplete="off"
              ></textarea>
            </div>

            <div>
              <label for="input-meaning" class="block mb-1 font-semibold text-gray-400"
                >Significado</label
              >
              <textarea
                id="input-meaning"
                name="meaning"
                rows="3"
                placeholder="Significado da palavra"
                class="w-full rounded-md bg-gray-700 border border-gray-600 text-gray-300 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-custom-blue focus:border-custom-blue px-3 py-2 resize-none"
                autocomplete="off"
                required
                aria-describedby="meaning-error"
              ></textarea>
              <p id="meaning-error" class="text-red-500 text-sm mt-1 hidden">
                Por favor, insira o significado.
              </p>
            </div>

            <div>
              <label for="input-image" class="block mb-1 font-semibold text-gray-400"
                >Imagem (URL)</label
              >
              <input
                type="url"
                id="input-image"
                name="image"
                placeholder="Cole a URL da imagem"
                class="w-full rounded-md bg-gray-700 border border-gray-600 text-gray-300 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-custom-blue focus:border-custom-blue px-3 py-2"
                autocomplete="off"
                aria-describedby="image-error"
              />
              <p id="image-error" class="text-red-500 text-sm mt-1 hidden">
                Por favor, insira uma URL válida.
              </p>
            </div>

            <div>
              <label class="block mb-1 font-semibold text-gray-400">Categoria</label>
              <div class="flex flex-col sm:flex-row gap-2">
                <input
                  type="text"
                  id="input-category-search"
                  placeholder="Pesquisar ou selecionar categoria"
                  class="flex-1 rounded-md bg-gray-700 border border-gray-600 text-gray-300 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-custom-blue focus:border-custom-blue px-3 py-2"
                  autocomplete="off"
                  aria-autocomplete="list"
                  aria-controls="category-listbox"
                  aria-expanded="false"
                  role="combobox"
                  aria-haspopup="listbox"
                />
                <button
                  type="button"
                  id="btn-create-category"
                  class="bg-[rgb(92,130,255)] hover:bg-[rgb(72,110,230)] text-white font-semibold rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-custom-blue"
                >
                  Criar Categoria
                </button>
              </div>
              <ul
                id="category-listbox"
                role="listbox"
                class="max-h-40 overflow-y-auto mt-1 bg-gray-700 rounded-md border border-gray-600 text-gray-300 hidden"
              ></ul>
            </div>

            <div class="flex space-x-4 justify-end">
              <button
                type="submit"
                class="bg-[rgb(92,130,255)] hover:bg-[rgb(72,110,230)] text-white font-semibold rounded-md px-6 py-2 focus:outline-none focus:ring-2 focus:ring-custom-blue"
              >
                Adicionar Palavra
              </button>
              <button
                type="reset"
                id="btn-discard"
                class="bg-gray-700 hover:bg-gray-600 text-gray-400 font-semibold rounded-md px-6 py-2 focus:outline-none focus:ring-2 focus:ring-custom-blue"
              >
                Descartar
              </button>
            </div>
          </form>
        </section>

        <!-- Learned Words Page -->
        <section id="page-learned" class="max-w-4xl mx-auto space-y-8 hidden">
          <h2 class="text-3xl font-bold text-custom-blue mb-2 select-none">
            Palavras Aprendidas
          </h2>
          <div id="learned-words-container" class="space-y-10">
            <!-- Categories and words will be dynamically inserted here -->
          </div>
        </section>
      </main>
    </div>
  </div>
 <div
    id="modal-edit-word"
    class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden"
    role="dialog"
    aria-modal="true"
  >
    <div class="bg-gray-800 rounded-lg max-w-lg w-full p-6 relative shadow-lg max-h-[90vh] overflow-y-auto">
      <button
        id="btn-close-edit-modal"
        class="absolute top-4 right-4 text-gray-400 hover:text-custom-blue focus:outline-none focus:ring-2 focus:ring-custom-blue rounded"
      >
        <i class="fas fa-times fa-lg"></i>
      </button>
      <h3 class="text-2xl font-bold text-custom-blue mb-4">Editar Palavra</h3>
      <form id="form-edit-word" class="space-y-4">
        <input type="hidden" id="edit-id" />
        <div>
          <label class="block text-gray-400 font-semibold mb-1">Palavra</label>
          <input id="edit-word" type="text" class="w-full px-3 py-2 rounded bg-gray-700 text-white" required />
        </div>
        <div>
          <label class="block text-gray-400 font-semibold mb-1">Significado</label>
          <textarea id="edit-meaning" class="w-full px-3 py-2 rounded bg-gray-700 text-white" rows="2" required></textarea>
        </div>
        <div>
          <label class="block text-gray-400 font-semibold mb-1">Contexto (opcional)</label>
          <textarea id="edit-context" class="w-full px-3 py-2 rounded bg-gray-700 text-white" rows="2"></textarea>
        </div>
        <div>
          <label class="block text-gray-400 font-semibold mb-1">URL da Imagem (opcional)</label>
          <input id="edit-image" type="url" class="w-full px-3 py-2 rounded bg-gray-700 text-white" />
        </div>
        <div>
          <label class="block text-gray-400 font-semibold mb-1">Categoria</label>
          <input id="edit-category" type="text" class="w-full px-3 py-2 rounded bg-gray-700 text-white" />
        </div>
        <div class="flex justify-end space-x-2">
          <button
            type="button"
            id="btn-cancel-edit"
            class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="px-4 py-2 bg-[rgb(92,130,255)] hover:bg-blue-600 rounded text-white"
          >
            Salvar
          </button>
        </div>
      </form>
    </div>
  </div>

  <div
    id="modal-word-details"
    class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-40 hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-word-title"
  >
    <div
      class="bg-gray-800 rounded-lg max-w-lg w-full p-6 relative shadow-lg max-h-[90vh] overflow-y-auto"
    >
      <button
        id="btn-close-modal"
        aria-label="Fechar detalhes da palavra"
        class="absolute top-4 right-4 text-gray-400 hover:text-[rgb(92,130,255)] focus:outline-none focus:ring-2 focus:ring-custom-blue rounded"
      >
        <i class="fas fa-times fa-lg"></i>
      </button>
      <h3 id="modal-word-title" class="text-2xl font-bold text-custom-blue mb-4"></h3>
      <div id="modal-word-content" class="space-y-4 text-gray-300">
        </div>
    </div>
  </div>
 <script type="module">
  // ===============================================================
  // 1. CONFIGURAÇÃO E INICIALIZAÇÃO DO FIREBASE
  // ===============================================================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyBHBNmm9p-EwE9oQ5L22TgA95dgqEpKCu4",
    authDomain: "my-dictionary-7a591.firebaseapp.com",
    projectId: "my-dictionary-7a591",
    storageBucket: "my-dictionary-7a591.appspot.com",
    messagingSenderId: "857389257735",
    appId: "1:857389257735:web:bebefde9efccf3ddc946a2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ===============================================================
  // 2. ELEMENTOS DA UI E ESTADO DA APLICAÇÃO
  // ===============================================================
  const appContainer = document.getElementById('app');
  const authContainer = document.getElementById('auth-container');
  const loginForm = document.getElementById('login-form');
  const authError = document.getElementById('auth-error');
  const logoutButton = document.getElementById('logout-button');
  const btnHamburger = document.getElementById('btn-hamburger');
  const checkboxHamburger = document.getElementById('checkbox');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const btnCloseSidebar = document.getElementById('btn-close-sidebar');
  const mainContent = document.getElementById('main-content');
  const sidebarTitle = document.querySelector('.sidebar-title');
  const sidebarTexts = document.querySelectorAll('.sidebar-text');
  const pageHome = document.getElementById('page-home');
  const pageLearned = document.getElementById('page-learned');
  const navButtons = sidebar.querySelectorAll('button[data-page]');
  const formAddWord = document.getElementById('form-add-word');
  const btnShowForm = document.getElementById('btn-show-form');
  const learnedWordsContainer = document.getElementById('learned-words-container');
  const modalWordDetails = document.getElementById('modal-word-details');
  const btnCloseModal = document.getElementById('btn-close-modal');
  const modalWordTitle = document.getElementById('modal-word-title');
  const modalWordContent = document.getElementById('modal-word-content');
  const inputWord = document.getElementById('input-word');
  const inputContext = document.getElementById('input-context');
  const inputMeaning = document.getElementById('input-meaning');
  const inputImage = document.getElementById('input-image');
  const inputCategorySearch = document.getElementById('input-category-search');
  const btnCreateCategory = document.getElementById('btn-create-category');
  const categoryListbox = document.getElementById('category-listbox');
  const btnDiscard = document.getElementById('btn-discard');

  let words = [];
  let categories = [];
  let currentUser = null;
  let isSidebarExpanded = window.innerWidth >= 768;
  let unsubscribeFromWords = null;

  // ===============================================================
  // 3. LÓGICA DE AUTENTICAÇÃO
  // ===============================================================
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      authContainer.classList.add('hidden');
      appContainer.classList.remove('hidden');
      logoutButton.classList.remove('hidden');
      loadData();
    } else {
      currentUser = null;
      if (unsubscribeFromWords) unsubscribeFromWords();
      authContainer.classList.remove('hidden');
      appContainer.classList.add('hidden');
      logoutButton.classList.add('hidden');
      words = [];
      renderLearnedWords();
    }
  });

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    authError.classList.add('hidden');
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (error) {
      if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
        try {
          await createUserWithEmailAndPassword(auth, email, password);
        } catch (createError) {
          authError.textContent = `Erro ao registrar: ${createError.message}`;
          authError.classList.remove('hidden');
        }
      } else {
        authError.textContent = `Erro ao entrar: ${error.message}`;
        authError.classList.remove('hidden');
      }
    }
  });

  logoutButton.addEventListener('click', () => { signOut(auth); });

  // ===============================================================
  // 4. LÓGICA DA BASE DE DADOS (FIRESTORE)
  // ===============================================================
  function loadData() {
    if (!currentUser) return;
    if (unsubscribeFromWords) unsubscribeFromWords();

    const q = query(collection(db, "palavras"), where("userId", "==", currentUser.uid));
    
    unsubscribeFromWords = onSnapshot(q, (querySnapshot) => {
      words = [];
      const categorySet = new Set();
      querySnapshot.forEach((doc) => {
        const wordData = doc.data();
        words.push({ id: doc.id, ...wordData });
        if(wordData.category) categorySet.add(wordData.category);
      });
      categories = Array.from(categorySet).sort();
      words.sort((a,b) => a.word.localeCompare(b.word));
      renderLearnedWords();
    });
  }

  async function addWord(newWordObject) {
    if (!currentUser) return;
    await addDoc(collection(db, "palavras"), { ...newWordObject, userId: currentUser.uid });
  }

  async function updateWord(wordId, updatedData) {
    if (!currentUser) return;
    const wordRef = doc(db, "palavras", wordId);
    await updateDoc(wordRef, updatedData);
  }

  async function deleteWord(wordId) {
    if (!currentUser) return;
    await deleteDoc(doc(db, "palavras", wordId));
  }

  // ===============================================================
  // 5. LÓGICA DA APLICAÇÃO (Formulários, Sidebar, Modais, etc.)
  // ===============================================================
  
  // --- Formulários ---
  formAddWord.addEventListener('submit', (e) => {
    e.preventDefault();
    const newWord = {
      word: inputWord.value.trim(),
      meaning: inputMeaning.value.trim(),
      context: inputContext.value.trim(),
      image: inputImage.value.trim(),
      category: inputCategorySearch.value.trim(),
    };
    if (!newWord.word || !newWord.meaning) {
        alert("Palavra e significado são obrigatórios.");
        return;
    }
    addWord(newWord);
    formAddWord.reset();
    inputCategorySearch.value = '';
    hideForm();
  });

  document.getElementById('form-edit-word').addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target;
    const wordId = form.querySelector('#edit-id').value;
    const updatedData = {
      word: form.querySelector('#edit-word').value.trim(),
      meaning: form.querySelector('#edit-meaning').value.trim(),
      context: form.querySelector('#edit-context').value.trim(),
      image: form.querySelector('#edit-image').value.trim(),
      category: form.querySelector('#edit-category').value.trim(),
    };
    updateWord(wordId, updatedData);
    document.getElementById('modal-edit-word').classList.add('hidden');
  });

  // --- Sidebar ---
  function updateSidebarState() {
    const isDesktop = window.innerWidth >= 768;
    mainContent.classList.remove('ml-20', 'ml-64');
    sidebar.classList.remove('w-20', 'w-64', '-translate-x-full');
    overlay.classList.add('hidden');
    sidebarTitle.classList.add('hidden');
    sidebarTexts.forEach(text => text.classList.add('hidden', 'opacity-0'));
    if (isDesktop) {
      if (isSidebarExpanded) {
        sidebar.classList.add('w-64');
        mainContent.classList.add('ml-64');
        sidebarTitle.classList.remove('hidden');
        sidebarTexts.forEach(text => text.classList.remove('hidden', 'opacity-0'));
      } else {
        sidebar.classList.add('w-20');
        mainContent.classList.add('ml-20');
      }
    } else {
      sidebar.classList.add('w-64');
      sidebarTitle.classList.remove('hidden');
      sidebarTexts.forEach(text => text.classList.remove('hidden', 'opacity-0'));
      if (isSidebarExpanded) {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
      } else {
        sidebar.classList.add('-translate-x-full');
      }
    }
    checkboxHamburger.checked = isSidebarExpanded;
  }
  function toggleSidebar() { isSidebarExpanded = !isSidebarExpanded; updateSidebarState(); }
  btnHamburger.addEventListener('click', toggleSidebar);
  btnCloseSidebar.addEventListener('click', toggleSidebar);
  overlay.addEventListener('click', toggleSidebar);
  window.addEventListener('resize', updateSidebarState);
  
  // --- Navegação de Página ---
  function showPage(page) {
    pageHome.classList.add('hidden');
    pageLearned.classList.add('hidden');
    if (page === 'home') pageHome.classList.remove('hidden');
    if (page === 'learned') pageLearned.classList.remove('hidden');
    
    navButtons.forEach(btn => {
      const isSelected = btn.dataset.page === page;
      btn.classList.toggle('bg-[rgb(92,130,255)]', isSelected);
      btn.classList.toggle('text-white', isSelected);
      btn.classList.toggle('text-custom-blue', !isSelected);
    });
    if (window.innerWidth < 768) { isSidebarExpanded = false; updateSidebarState(); }
  }
  navButtons.forEach(btn => { btn.addEventListener('click', () => showPage(btn.dataset.page)); });

  // --- Renderização e Modais ---
  function renderLearnedWords() {
    if (!learnedWordsContainer) return;
    if (words.length === 0) {
      learnedWordsContainer.innerHTML = '<p class="text-gray-500 italic">Nenhuma palavra adicionada ainda.</p>';
      return;
    }
    const grouped = words.reduce((acc, w) => {
        const cat = w.category || 'Sem Categoria';
        if (!acc[cat]) acc[cat] = [];
        acc[cat].push(w);
        return acc;
    }, {});
    const sortedCats = Object.keys(grouped).sort();
    learnedWordsContainer.innerHTML = sortedCats.map(cat => `
        <div class="space-y-3">
            <h3 class="text-xl font-extrabold text-custom-blue">${cat}</h3>
            <ul class="space-y-1">
                ${grouped[cat].map(w => `
                    <li class="rounded-md px-3 py-2 hover:bg-[rgb(92,130,255)] flex justify-between items-center cursor-pointer" onclick="openModalWordDetails('${w.id}')">
                        <span class="flex-1">${w.word}</span>
                        <button class="ml-4 p-2 text-gray-400 hover:text-white" onclick="event.stopPropagation(); openEditModal('${w.id}');">
                            <i class="fas fa-pen"></i>
                        </button>
                    </li>
                `).join('')}
            </ul>
        </div>
    `).join('');
  }
  
  function openModalWordDetails(wordId) {
    const word = words.find(w => w.id === wordId);
    if (!word) return;
    modalWordTitle.textContent = word.word;
    modalWordContent.innerHTML = `...`; // Sua lógica de innerHTML para detalhes
    modalWordDetails.classList.remove('hidden');
  }
  
  function openEditModal(wordId) {
    const word = words.find(w => w.id === wordId);
    if (!word) return;
    const modal = document.getElementById('modal-edit-word');
    modal.querySelector('#edit-id').value = word.id;
    modal.querySelector('#edit-word').value = word.word;
    // ... preencher o resto dos campos
    modal.classList.remove('hidden');
  }

  // Disponibiliza funções globalmente para o HTML poder chamá-las
  window.openModalWordDetails = openModalWordDetails;
  window.openEditModal = openEditModal;
  
  // ... (O resto das suas funções helper como hideForm, showForm, etc. aqui)
  function hideForm() { formAddWord.classList.add('hidden'); btnShowForm.classList.remove('hidden'); }
  function showForm() { formAddWord.classList.remove('hidden'); btnShowForm.classList.add('hidden'); }
  btnShowForm.addEventListener('click', showForm);
  btnDiscard.addEventListener('click', hideForm);
  
  // ===============================================================
  // 6. INICIALIZAÇÃO DA APLICAÇÃO
  // ===============================================================
  function initialize() {
    updateSidebarState();
    showPage('home');
    // loadData() é chamado pelo onAuthStateChanged
  }
  
  initialize();
})();
</script>
</body>
</html>           